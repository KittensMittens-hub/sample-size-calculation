---
title: "sample size"
author: "Natalya"
date: "2025-12-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(TrialSize)
sessionInfo()
```

Рассчитайте объёмы выборок для следующих клинических исследований.
Опишите предположения, которые были выдвинуты при анализе.
Воспользуйтесь примером оформления результатов, который приведён далее.
Частота выбывания пациентов в ходе исследования – 20%. Частота выбывания пациентов в ходе скрининга – 10%. Ошибку первого рода для односторонних гипотез установите на уровне 0.025,мощность – 80%.

# 1.
Исследование не меньшей эффективности препарата T в сравнении с препаратом R в лечении хронической обструктивной болезни лёгких (ХОБЛ). Первичная конечная точка – абсолютное увеличение индекса Тиффно (ОФВ1/ЖЕЛ) за 3 месяца терапии в сравнении со значениями на 1 визите. Из литературных данных известно, что для препарата R абсолютный прирост индекса за 3 месяца в среднем (M±SD) составлял 7.2 ± 3.1% (процентных пунктов – п.п.). Предлагаемая граница не меньшей эффективности – 2 % (п.п.).


Статистическая гипотеза не меньшей эффективности в исследовании была сформулирована следующим
образом:
H₀: Pт - Pс ≤ -δ
Hₐ: Pт - Pс > -δ

Где PT – абсолютное увеличение индекса Тиффно  за 3 месяца терапии в сравнении со значениями на 1 визите в группе препарата T, PС – то же в группе R. 
контрольной группе. δ – граница не меньшей эффективности (2%).
При расчёте необходимого размера выборки были сделаны следующие допущения:
1. Распределение в группы будет равномерным в соотношении 1:1;
2. Односторонняя величина ошибки I рода (α) составляет 0.025;
3. Мощность исследования должна составлять 80%, соответственно, предельная величина ошибки II рода (β) = 0.2;
4. На основании литературных данных мы ожидаем величину эффекта в группе
препаратов 7.2 ± 3.1%
5. Граница превосходства препарата по сравнению с активным контролем равна 2%.
Расчёт размера выборки был проведён в RStudio (версия 2025.09.2 Build 418) c использованием языка R (версия 4.5.2) с помощью функции TwoSampleMean.NIS пакета TrialSize (версия 1.4.1). Результаты расчёта представлены далее.

```{r}
result <- TwoSampleMean.NIS(
    alpha = 0.025,
    beta = 0.2,
    sigma = 3.1,
    k = 1,
    delta = 0,
    margin = 2  
)

print(result) 

n_per_group <- result 
n_per_group_adjusted_1 <- ceiling(n_per_group / (1 - 0.2))

print(n_per_group_adjusted_1)

n_per_group_adjusted_2 <- ceiling(n_per_group_adjusted_1 / (1 - 0.1))

print(n_per_group_adjusted_2)
```
Таким образом, в каждую группу необходимо включить не менее 38 обследуемых, всего – 76 пациента.С учётом частоты выбывания пациентов в ходе исследования, равной 20%, в каждую группу необходимо набрать не менее 48 человек (всего 96) В скрининг (с учётом 10% выбывания) необходимо включить не менее 54 обследуемых в каждую группу (всего 108).

# 2 
Исследование превосходства препарата T над референтным лечением R в лечении
рассеянного склероза. Первичный показатель эффективности – доля пациентов, у которых к визиту 3 (12 мес.) нет новых очагов по МРТ, развившихся в период наблюдения. Согласно литературным данным, на фоне применения препарата R доля пациентов без новых очагов составляет 66%. Ожидается, что препарат T будет эффективнее препарата R примерно на 15% (п.п.), при этом спонсор хотел бы, чтобы граница превосходства была бы равна 1% (п.п.). Спонсор просит, чтобы в группу T было рандомизировано в 2 раза больше пациентов, чем в группу R.

Статистическая гипотеза превосходства в исследовании была сформулирована следующим образом:
H0: PT – PС ≤ δ
HA: PT – PС > δ

Где PT – доля пациентов, у которых к визиту 3 нет новых очагов по МРТ на терапии T, PС – то же на терапии R.  δ – граница превосходства (1%).
При расчёте необходимого размера выборки были сделаны следующие допущения:
1. Распределение в группы будет неравномерным в соотношении 2:1;
2. Односторонняя величина ошибки I рода (α) составляет 0.025;
3. Мощность исследования должна составлять 80%, соответственно, предельная величина ошибки II рода (β) = 0.2;
4. На основании литературных данных мы ожидаем величину эффекта в группе
препарата R 66%, в группе препарата T - 66+15 = 81% (дельта = 15%)
5. Граница превосходства препарата по сравнению с активным контролем равна 1%.
Расчёт размера выборки был проведён в RStudio (версия 2025.09.2 Build 418) c использованием языка R (версия 4.5.2) с помощью функции TwoSampleProportion.NIS пакета TrialSize (версия 1.4.1). Результаты расчёта представлены далее.

```{r}
?TwoSampleProportion.NIS


TwoSampleProportion.NIS(
alpha = 0.025,
beta = 0.2,
p1 = 0.81,
p2 = 0.66,
k = 2,
delta = 0.15,
margin = 0.01
)


n_per_group <- result 
n_per_group_adjusted_1 <- ceiling(n_per_group / (1 - 0.2))

print(n_per_group_adjusted_1)

n_per_group_adjusted_2 <- ceiling(n_per_group_adjusted_1 / (1 - 0.1))

print(n_per_group_adjusted_2)

```
по расчетам: 242 - количество в группе Т, 120 в группе R (всего 362)
с учетом 267 - количество в группе Т, 134 в группе R (всего 401)
297 - количество в группе Т, 149 в группе R (всего 445)

Таким образом, в каждую группу необходимо включить не менее 38 обследуемых, всего – 76 пациента.С учётом частоты выбывания пациентов в ходе исследования, равной 20%, в каждую группу необходимо набрать не менее 48 человек (всего 96) В скрининг (с учётом 10% выбывания) необходимо включить не менее 54 обследуемых в каждую группу (всего 108).

