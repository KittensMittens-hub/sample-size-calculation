---
title: "sample size"
author: "Natalya"
date: "2025-12-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(TrialSize)
sessionInfo()
```

Рассчитайте объёмы выборок для следующих клинических исследований.
Опишите предположения, которые были выдвинуты при анализе.
Воспользуйтесь примером оформления результатов, который приведён далее.
Частота выбывания пациентов в ходе исследования – 20%. Частота выбывания пациентов в ходе скрининга – 10%. Ошибку первого рода для односторонних гипотез установите на уровне 0.025,мощность – 80%.

# 1.
Исследование не меньшей эффективности препарата T в сравнении с препаратом R в лечении хронической обструктивной болезни лёгких (ХОБЛ). Первичная конечная точка – абсолютное увеличение индекса Тиффно (ОФВ1/ЖЕЛ) за 3 месяца терапии в сравнении со значениями на 1 визите. Из литературных данных известно, что для препарата R абсолютный прирост индекса за 3 месяца в среднем (M±SD) составлял 7.2 ± 3.1% (процентных пунктов – п.п.). Предлагаемая граница не меньшей эффективности – 2 % (п.п.).


Статистическая гипотеза не меньшей эффективности в исследовании была сформулирована следующим образом:  
H₀: Pт - Pс ≤ -δ  
Hₐ: Pт - Pс > -δ  

Где PT – абсолютное увеличение индекса Тиффно  за 3 месяца терапии в сравнении со значениями на 1 визите в группе препарата T, PС – то же в группе R. δ – граница не меньшей эффективности (2%).  
При расчёте необходимого размера выборки были сделаны следующие допущения:
1. Распределение в группы будет равномерным в соотношении 1:1;  
2. Односторонняя величина ошибки I рода (α) составляет 0.025;  
3. Мощность исследования должна составлять 80%, соответственно, предельная величина ошибки II рода (β) = 0.2;  
4. На основании литературных данных мы ожидаем величину эффекта в группе
препаратов 7.2 ± 3.1%  
5. Граница превосходства препарата по сравнению с активным контролем равна 2%.  
Расчёт размера выборки был проведён в RStudio (версия 2025.09.2 Build 418) c использованием языка R (версия 4.5.2) с помощью функции TwoSampleMean.NIS пакета TrialSize (версия 1.4.1). Результаты расчёта представлены далее.  

```{r}
result <- TwoSampleMean.NIS(
    alpha = 0.025,
    beta = 0.2,
    sigma = 3.1,
    k = 1,
    delta = 0,
    margin = 2  
)

print(result) 

n_per_group <- result 
n_per_group_adjusted_1 <- ceiling(n_per_group / 0.9)

print(n_per_group_adjusted_1)

n_per_group_adjusted_2 <- ceiling(n_per_group_adjusted_1 / 0.8)

print(n_per_group_adjusted_2)
```
Таким образом, в каждую группу необходимо включить не менее 38 обследуемых, всего – 76 пациентов.С учётом частоты выбывания пациентов в ходе исследования, равной 20%, в каждую группу необходимо набрать не менее 42 человек (всего 84). В скрининг (с учётом 10% выбывания) необходимо включить не менее 53 обследуемых в каждую группу (всего 106). **Вероятно, по всем задачам правильнее написать: в скрининг всего ХХХ, без упоминания о разделении по группам (так как на скрининге по группам не разделяют)**

# 2 
Исследование превосходства препарата T над референтным лечением R в лечении
рассеянного склероза. Первичный показатель эффективности – доля пациентов, у которых к визиту 3 (12 мес.) нет новых очагов по МРТ, развившихся в период наблюдения. Согласно литературным данным, на фоне применения препарата R доля пациентов без новых очагов составляет 66%. Ожидается, что препарат T будет эффективнее препарата R примерно на 15% (п.п.), при этом спонсор хотел бы, чтобы граница превосходства была бы равна 1% (п.п.). Спонсор просит, чтобы в группу T было рандомизировано в 2 раза больше пациентов, чем в группу R.  

Статистическая гипотеза превосходства в исследовании была сформулирована следующим образом:  
H0: PT – PС ≤ δ  
HA: PT – PС > δ  

Где PT – доля пациентов, у которых к визиту 3 нет новых очагов по МРТ на терапии T, PС – то же на терапии R.  δ – граница превосходства (1%).
При расчёте необходимого размера выборки были сделаны следующие допущения:  
1. Распределение в группы будет неравномерным в соотношении 2:1;  
2. Односторонняя величина ошибки I рода (α) составляет 0.025;  
3. Мощность исследования должна составлять 80%, соответственно, предельная величина ошибки II рода (β) = 0.2;  
4. На основании литературных данных мы ожидаем величину эффекта в группе
препарата R 66%, в группе препарата T - 66+15 = 81% (дельта = 15%)  
5. Граница превосходства препарата по сравнению с активным контролем равна 1%.  
Расчёт размера выборки был проведён в RStudio (версия 2025.09.2 Build 418) c использованием языка R (версия 4.5.2) с помощью функции TwoSampleProportion.NIS пакета TrialSize (версия 1.4.1). Результаты расчёта представлены далее.  

```{r}
?TwoSampleProportion.NIS


result2 <- TwoSampleProportion.NIS(
alpha = 0.025,
beta = 0.2,
p1 = 0.81,
p2 = 0.66,
k = 2,
delta = 0.15,
margin = 0.01
)

print(result2)

result2adj <- ceiling(result2 / 0.8)

print(result2adj)

result2adj2 <- ceiling(result2adj / 0.9)

print(result2adj2)
```
По расчетам: 242 - количество в группе Т, 120 в группе R (всего 362). С учетом выбывания на уровне 20% в ходе исследования - 302 в группе Т,151 в группе R (всего 453) C учетом выбывания на уровне 10% на скрининге - 336 в группе T, 168 в группе R (всего 504)


#3 
Исследование превосходства нового препарата А над препаратом Б в профилактике
интраоперационных кровотечений. Первичная конечная точка – объём кровопотери в мл. Из данных литературы известно, что средний объём кровопотери при применении препарата Б составляет 306 ± 52 мл. Ожидается, что препарат А в среднем будет снижать объём кровопотери на 20% в сравнении с препаратом Б. Границу превосходства предполагается установить равной 50 мл. Спонсор просит рассчитать объём выборок таким образом, чтобы препарат А получили 75% пациентов, включённых в исследование.  


Статистическая гипотеза превосхоства в исследовании была сформулирована следующим образом:  
H₀: Pт - Pс ≥ -δ  
Hₐ: Pт - Pс < -δ  

Где PT – объем кровопотери в группе А, PС – то же в группе Б. 
контрольной группе. δ – граница превосходства = 50  
При расчёте необходимого размера выборки были сделаны следующие допущения:  
1. Распределение в группы будет неравномерным в соотношении 3:1;  
2. Односторонняя величина ошибки I рода (α) составляет 0.025;  
3. Мощность исследования должна составлять 80%, соответственно, предельная величина ошибки II рода (β) = 0.2;  
4. На основании литературных данных мы ожидаем величину эффекта в группе
препарата Б 306 ± 52 мл, в группе А на 20% меньше = 244.8 ± 52 мл %  
5. Граница превосходства препарата по сравнению с активным контролем равна 50 мл.  
Расчёт размера выборки был проведён в RStudio (версия 2025.09.2 Build 418) c использованием языка R (версия 4.5.2) с помощью функции TwoSampleMean.NIS пакета TrialSize (версия 1.4.1). Результаты расчёта представлены далее.  

```{r}
result3 <- TwoSampleMean.NIS(
    alpha = 0.025,
    beta = 0.2,
    sigma = 52,
    k = 3,
    delta = -61.2,
    margin = -50  
)

print(result3) 

result3adj <- ceiling(result3 / 0.8)

print(result3adj)

result3adj2 <- ceiling(result3adj / 0.9)

print(result3adj2)
```
Таким образом, в группу А необходимо включить 677 пациентов, в группу Б - 226 человек (всего 903). С учётом 20% выбывания в ходе исследования: в группу А 846 человек, в группу Б - 282 человека (всего 1128). С учетом 10% выбывания на скрининге в группу А 940, в группу Б 314 (всего 1254).


# 4
Известно, что на фоне лечения препаратом Х рецидив псориатического артрита за 6 месяцев наблюдается в 32% случаев (ремиссия в 68%). Спонсор хочет исследовать новый препарат У, который, как ожидается, снизит частоту рецидивов на 15% (п.п.) (то есть до 17%, а частоту ремиссии поднимет до 83%). Границей превосходства можно считать снижение доли пациентов с рецидивом или повышение доли пациентов с ремиссией более, чем на 5% (п.п.). При этом существует сложность. У спонсора в наличии имеется только 250 пачек препарата Х и он просит, чтобы рандомизационное соотношение было таким, чтобы препарата хватило на проведение исследования. Выбывание на скрининге -10%, в ходе исследования -20%.    



Статистическая гипотеза превосходства в исследовании была сформулирована следующим образом:  
H0: PT – PС <= δ  
HA: PT – PС > δ  

Где PT – частота ремиссий в группе Y, PС – то же в группе X.  δ – граница превосходства (5%).  
При расчёте необходимого размера выборки были сделаны следующие допущения:  
1. Распределение в группы с учетом ограниченного кол-ва препарата Х будет 4:1 (У:Х);  
2. Односторонняя величина ошибки I рода (α) составляет 0.025;  
3. Мощность исследования должна составлять 80%, соответственно, предельная величина ошибки II рода (β) = 0.2;  
4. На основании литературных данных мы ожидаем величину эффекта в группе
препарата R 68%, в группе препарата T 83% (дельта = 15%)  
5. Граница превосходства препарата по сравнению с активным контролем равна 5%.  
Расчёт размера выборки был проведён в RStudio (версия 2025.09.2 Build 418) c использованием языка R (версия 4.5.2) с помощью функции TwoSampleProportion.NIS пакета TrialSize (версия 1.4.1). Результаты расчёта представлены далее.  


```{r}

result4 <- TwoSampleProportion.NIS(
alpha = 0.025,
beta = 0.2,
p1 = 0.83,
p2 = 0.68,
k = 4,
delta = 0.15,
margin = 0.05
)

print(result4)

result4adj <- ceiling(result4 / 0.8)

print(result4adj)

result4adj2 <- ceiling(result4adj / 0.9)

print(result4adj2)

```
Разрешение дается на кол-во рандомизированных пациентов, поэтому соотношение подбиралось под кол-во участников с учетом выбывания в ходе исследования. В результате: 794 в группу У, 199 в группу Х (всего 993). С учетом 20% выбывания в ходе исследования  - в группу У 993, в группу Х - 249. С учетом 10% выбывания в ходе скрининга 1104 в группу У, 276 в группу Х (всего 1380).

`
